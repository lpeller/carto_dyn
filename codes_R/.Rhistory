table_stage$winner = substr("\n", "", table_win$X3)
table_stage$winner = substr(table_win$X3, 0, str_locate(table_win$X3, "\n"))
url_win
length(table_stage$X2[0])
table_stage$X2[0]
table_stage$X2
length(table_stage$X2[1])
table_stage$X2[1]
nchar(table_stage$X2[1]7)
nchar(table_stage$X2[1])
year = substr(table_stage$X2[1],nchar(table_stage$X2[1])-4, nchar(table_stage$X2[1]))
year
year = substr(table_stage$X2[1],nchar(table_stage$X2[1])-3, nchar(table_stage$X2[1]))
#INITIALISATION
url_main = "https://www.letour.fr/fr/histoire"
url_base = "https://www.letour.fr"
html_main = read_html(url_main)
View(html_main)
xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_main, 2), 2), 3), 1), 3), 1), 1), 1), 2), 1), 12), 1))[["data-tabs-ajax"]]
xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_main, 2), 2), 3), 1), 3), 1), 1), 1), 2), 1), 50), 1))[["data-tabs-ajax"]]
xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_main, 2), 2), 3), 1), 3), 1), 1), 1), 2), 1), 111.), 1))[["data-tabs-ajax"]]
xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_main, 2), 2), 3), 1), 3), 1), 1), 1), 2), 1), 111), 1))[["data-tabs-ajax"]]
xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_main, 2), 2), 3), 1), 3), 1), 1), 1), 2), 1), 11), 1))[["data-tabs-ajax"]]
xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_main, 2), 2), 3), 1), 3), 1), 1), 1), 2), 1), 105), 1))[["data-tabs-ajax"]]
xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_main, 2), 2), 3), 1), 3), 1), 1), 1), 2), 1), 106), 1))[["data-tabs-ajax"]]
xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_main, 2), 2), 3), 1), 3), 1), 1), 1), 2), 1), 107), 1))[["data-tabs-ajax"]]
xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_main, 2), 2), 3), 1), 3), 1), 1), 1), 2), 1), 109), 1))[["data-tabs-ajax"]]
xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_main, 2), 2), 3), 1), 3), 1), 1), 1), 2), 1), 110), 1))[["data-tabs-ajax"]]
columns= c("ville","occurences")
myData = data.frame(matrix(nrow = 0, ncol = length(columns)))
villes = data.frame(matrix(nrow = 0, ncol = length(columns)))
colnames(villes) = columns
View(villes)
#INITIALISATION
url_main = "https://www.letour.fr/fr/histoire"
url_base = "https://www.letour.fr"
html_main = read_html(url_main)
e = 1
while(e <= 109){
#lecture pour une année donnée :
url_year = paste(url_base, xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_main, 2), 2), 3), 1), 3), 1), 1), 1), 2), 1), e), 1))[["data-tabs-ajax"]], sep = "")
html_year = read_html(url_year)
url_stage = paste(url_base,xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_year, 1), 1), 3), 2), 4), 1))[["data-tabs-ajax"]], sep = "")
html_stage = read_html(url_stage)
url_win = paste(url_base, xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_year, 1), 1), 3), 2), 6), 1))[["data-tabs-ajax"]], sep = "")
html_win = read_html(url_win)
table_stage = html_stage %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
colnames(table_stage) <- c("n","")
table_win = html_win %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
table_stage$winner = substr(table_win$X3, 0, str_locate(table_win$X3, "\n"))
year = substr(table_stage$X2[1],nchar(table_stage$X2[1])-3, nchar(table_stage$X2[1]))
output_name = paste("stages_",year,".csv", sep = "")
write.csv()
print(paste("Finished year",year))
Sys.sleep(1)
e = e+1
}
#lecture pour une année donnée :
url_year = paste(url_base, xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_main, 2), 2), 3), 1), 3), 1), 1), 1), 2), 1), e), 1))[["data-tabs-ajax"]], sep = "")
html_year = read_html(url_year)
url_stage = paste(url_base,xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_year, 1), 1), 3), 2), 4), 1))[["data-tabs-ajax"]], sep = "")
html_stage = read_html(url_stage)
url_win = paste(url_base, xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_year, 1), 1), 3), 2), 6), 1))[["data-tabs-ajax"]], sep = "")
html_win = read_html(url_win)
table_stage = html_stage %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
colnames(table_stage) <- c("n","")
table_win = html_win %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
table_stage$winner = substr(table_win$X3, 0, str_locate(table_win$X3, "\n"))
year = substr(table_stage$X2[1],nchar(table_stage$X2[1])-3, nchar(table_stage$X2[1]))
year = substr(table_stage$X2[1],nchar(table_stage$X2[1])-3, nchar(table_stage$X2[1]))
table_stage$X2
table_stage
colnames(table_stage) <- c("n","annee","depart","arrivee")
#INITIALISATION
url_main = "https://www.letour.fr/fr/histoire"
url_base = "https://www.letour.fr"
html_main = read_html(url_main)
e = 1
while(e <= 109){
#lecture pour une année donnée :
url_year = paste(url_base, xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_main, 2), 2), 3), 1), 3), 1), 1), 1), 2), 1), e), 1))[["data-tabs-ajax"]], sep = "")
html_year = read_html(url_year)
url_stage = paste(url_base,xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_year, 1), 1), 3), 2), 4), 1))[["data-tabs-ajax"]], sep = "")
html_stage = read_html(url_stage)
url_win = paste(url_base, xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_year, 1), 1), 3), 2), 6), 1))[["data-tabs-ajax"]], sep = "")
html_win = read_html(url_win)
table_stage = html_stage %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
colnames(table_stage) <- c("n","annee","depart","arrivee")
table_win = html_win %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
table_stage$winner = substr(table_win$X3, 0, str_locate(table_win$X3, "\n"))
year = substr(table_stage$annee[1],nchar(table_stage$annee[1])-3, nchar(table_stage$annee[1]))
output_name = paste("stages_",year,".csv", sep = "")
write.csv()
print(paste("Finished year",year))
Sys.sleep(1)
e = e+1
}
#lecture pour une année donnée :
url_year = paste(url_base, xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_main, 2), 2), 3), 1), 3), 1), 1), 1), 2), 1), e), 1))[["data-tabs-ajax"]], sep = "")
html_year = read_html(url_year)
url_stage = paste(url_base,xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_year, 1), 1), 3), 2), 4), 1))[["data-tabs-ajax"]], sep = "")
html_stage = read_html(url_stage)
url_win = paste(url_base, xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_year, 1), 1), 3), 2), 6), 1))[["data-tabs-ajax"]], sep = "")
html_win = read_html(url_win)
table_stage = html_stage %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
colnames(table_stage) <- c("n","annee","depart","arrivee")
table_win = html_win %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
table_stage$winner = substr(table_win$X3, 0, str_locate(table_win$X3, "\n"))
year = substr(table_stage$annee[1],nchar(table_stage$annee[1])-3, nchar(table_stage$annee[1]))
output_name = paste("stages_",year,".csv", sep = "")
write.csv(table_stage, output_name)
output_name = paste("output/stages_",year,".csv", sep = "")
write.csv(table_stage, output_name)
#INITIALISATION
url_main = "https://www.letour.fr/fr/histoire"
url_base = "https://www.letour.fr"
html_main = read_html(url_main)
e = 1
while(e <= 109){
#lecture pour une année donnée :
url_year = paste(url_base, xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_main, 2), 2), 3), 1), 3), 1), 1), 1), 2), 1), e), 1))[["data-tabs-ajax"]], sep = "")
html_year = read_html(url_year)
url_stage = paste(url_base,xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_year, 1), 1), 3), 2), 4), 1))[["data-tabs-ajax"]], sep = "")
html_stage = read_html(url_stage)
url_win = paste(url_base, xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_year, 1), 1), 3), 2), 6), 1))[["data-tabs-ajax"]], sep = "")
html_win = read_html(url_win)
table_stage = html_stage %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
colnames(table_stage) <- c("n","annee","depart","arrivee")
table_win = html_win %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
table_stage$winner = substr(table_win$X3, 0, str_locate(table_win$X3, "\n"))
year = substr(table_stage$annee[1],nchar(table_stage$annee[1])-3, nchar(table_stage$annee[1]))
output_name = paste("output/stages_",year,".csv", sep = "")
write.csv(table_stage, output_name)
print(paste("Finished year",year))
Sys.sleep(1)
e = e+1
}
e = 5
while(e <= 109){
#lecture pour une année donnée :
url_year = paste(url_base, xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_main, 2), 2), 3), 1), 3), 1), 1), 1), 2), 1), e), 1))[["data-tabs-ajax"]], sep = "")
html_year = read_html(url_year)
url_stage = paste(url_base,xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_year, 1), 1), 3), 2), 4), 1))[["data-tabs-ajax"]], sep = "")
html_stage = read_html(url_stage)
url_win = paste(url_base, xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_year, 1), 1), 3), 2), 6), 1))[["data-tabs-ajax"]], sep = "")
html_win = read_html(url_win)
table_stage = html_stage %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
colnames(table_stage) <- c("n","annee","depart","arrivee")
table_win = html_win %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
table_stage$winner = substr(table_win$X3, 0, str_locate(table_win$X3, "\n"))
year = substr(table_stage$annee[1],nchar(table_stage$annee[1])-3, nchar(table_stage$annee[1]))
output_name = paste("output/stages_",year,".csv", sep = "")
write.csv(table_stage, output_name)
print(paste("Finished year",year))
Sys.sleep(1)
e = e+1
}
#lecture pour une année donnée :
url_year = paste(url_base, xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_main, 2), 2), 3), 1), 3), 1), 1), 1), 2), 1), e), 1))[["data-tabs-ajax"]], sep = "")
html_year = read_html(url_year)
url_stage = paste(url_base,xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_year, 1), 1), 3), 2), 4), 1))[["data-tabs-ajax"]], sep = "")
html_stage = read_html(url_stage)
url_win = paste(url_base, xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_year, 1), 1), 3), 2), 6), 1))[["data-tabs-ajax"]], sep = "")
html_win = read_html(url_win)
table_stage = html_stage %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
colnames(table_stage) <- c("n","annee","depart","arrivee")
table_win = html_win %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
table_stage$winner = substr(table_win$X3, 0, str_locate(table_win$X3, "\n"))
View(table_stage)
View(table_win)
table_win$X3
substr(table_win$X3, 0, str_locate(table_win$X3, "\n"))
table_stage$winner = substr(table_win$X3, 0, str_locate(table_win$X3, "\n")-2)
str_locate(table_win$X3, "\n")
table_stage$winner = substr(table_win$X3, 0, str_locate(table_win$X3, "\n")[1])
library("dplyr")
table_stage <- table_stage %>% mutate(id = row_number())
table_stage <- merge(x = table_stage, y = table_win, by.x = "id", by.y = "X1", all.x = TRUE)
table_stage$winner = substr(table_stage$X3, 0, str_locate(table_stage$X3, "\n")[1])
table_stage <- table_stage[,!names(table_stage) %in% c("X2", "X3")]
#INITIALISATION
url_main = "https://www.letour.fr/fr/histoire"
url_base = "https://www.letour.fr"
html_main = read_html(url_main)
e = 1
while(e <= 109){
#lecture pour une année donnée :
url_year = paste(url_base, xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_main, 2), 2), 3), 1), 3), 1), 1), 1), 2), 1), e), 1))[["data-tabs-ajax"]], sep = "")
html_year = read_html(url_year)
url_stage = paste(url_base,xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_year, 1), 1), 3), 2), 4), 1))[["data-tabs-ajax"]], sep = "")
html_stage = read_html(url_stage)
url_win = paste(url_base, xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_year, 1), 1), 3), 2), 6), 1))[["data-tabs-ajax"]], sep = "")
html_win = read_html(url_win)
table_stage = html_stage %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
colnames(table_stage) <- c("n","annee","depart","arrivee")
table_win = html_win %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
table_stage <- table_stage %>% mutate(id = row_number())
table_stage <- merge(x = table_stage, y = table_win, by.x = "id", by.y = "X1", all.x = TRUE)
table_stage$winner = substr(table_stage$X3, 0, str_locate(table_stage$X3, "\n")[1])
table_stage <- table_stage[,!names(table_stage) %in% c("X2", "X3")]
year = substr(table_stage$annee[1],nchar(table_stage$annee[1])-3, nchar(table_stage$annee[1]))
output_name = paste("output/stages_",year,".csv", sep = "")
write.csv(table_stage, output_name)
print(paste("Finished year",year))
Sys.sleep(1)
e = e+1
}
e
#lecture pour une année donnée :
url_year = paste(url_base, xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_main, 2), 2), 3), 1), 3), 1), 1), 1), 2), 1), e), 1))[["data-tabs-ajax"]], sep = "")
html_year = read_html(url_year)
url_stage = paste(url_base,xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_year, 1), 1), 3), 2), 4), 1))[["data-tabs-ajax"]], sep = "")
html_stage = read_html(url_stage)
url_win = paste(url_base, xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_year, 1), 1), 3), 2), 6), 1))[["data-tabs-ajax"]], sep = "")
url_stage
library(rvest)
library(stringr)
library(plyr)
library(xml2)
library(httr)
library(dplyr)
require(httr)
#INITIALISATION
url_main = "https://www.letour.fr/fr/histoire"
url_base = "https://www.letour.fr"
html_main = read_html(url_main)
e = 1
#lecture pour une année donnée :
url_year = paste(url_base, xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_main, 2), 2), 3), 1), 3), 1), 1), 1), 2), 1), e), 1))[["data-tabs-ajax"]], sep = "")
html_year = read_html(url_year)
url_stage = paste(url_base,xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_year, 1), 1), 3), 2), 4), 1))[["data-tabs-ajax"]], sep = "")
url_stage = html_year %>%
html_node(xpath = '//*[@data-tabs-target="stages"]')
View(url_stage)
url_stage = html_year %>%
html_node(xpath = '//*[@data-tabs-target="stages"]') %>%
html_text()
url_stage = html_year %>%
html_node(xpath = '//*[@data-tabs-target="stages"]')
url_stage
url_stage = html_year %>%
html_node(xpath = '//*[@data-tabs-target="stages"]') %>%
xml_attrs()
url_stage
url_stage[3]
url_stage = html_year %>%
html_node(xpath = '//*[@data-tabs-target="stages"]') %>%
xml_attrs()[3]
url_stage = (html_year %>%
html_node(xpath = '//*[@data-tabs-target="stages"]') %>%
xml_attrs())[3]
url_stage
url_stage = (html_year %>%
html_node(xpath = '//*[@data-tabs-target="stages"]') %>%
xml_attrs())[3][2]
url_stage = (html_year %>%
html_node(xpath = '//*[@data-tabs-target="stages"]') %>%
xml_attrs())[3][2]
url_stage
url_stage = (html_year %>%
html_node(xpath = '//*[@data-tabs-target="stages"]') %>%
xml_attrs())[3][1]
url_stage
url_stage = (html_year %>%
html_node(xpath = '//*[@data-tabs-target="stages"]') %>%
xml_attrs())[3] %>%
html_text()
url_stage = (html_year %>%
html_node(xpath = '//*[@data-tabs-target="stages"]') %>%
xml_attrs())[3] %>%
xml_text()
url_stage = (html_year %>%
html_node(xpath = '//*[@data-tabs-target="stages"]') %>%
xml_attrs())[3]
url_stage
paste(url_base, url_stage, sep  ="")
str_locate(table_stage$X3, "\n")[1]
#lecture pour une année donnée :
url_year = paste(url_base, xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_main, 2), 2), 3), 1), 3), 1), 1), 1), 2), 1), e), 1))[["data-tabs-ajax"]], sep = "")
html_year = read_html(url_year)
url_stage = (html_year %>%
html_node(xpath = '//*[@data-tabs-target="stages"]') %>%
xml_attrs())[3]
url_stage = paste(url_base, url_stage, sep  ="")
html_stage = read_html(url_stage)
url_win = (html_year %>%
html_node(xpath = '//*[@data-tabs-target="winners"]') %>%
xml_attrs())[3]
url_win = paste(url_base, url_win, sep = "")
html_win = read_html(url_win)
table_stage = html_stage %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
colnames(table_stage) <- c("n","annee","depart","arrivee")
table_win = html_win %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
table_stage <- table_stage %>% mutate(id = row_number())
table_stage <- merge(x = table_stage, y = table_win, by.x = "id", by.y = "X1", all.x = TRUE)
table_stage$winner = substr(table_stage$X3, 0, str_locate(table_stage$X3, "\n")[1])
table_stage <- table_stage[,!names(table_stage) %in% c("X2", "X3")]
year = substr(table_stage$annee[1],nchar(table_stage$annee[1])-3, nchar(table_stage$annee[1]))
table_stage$winner
table_stage$winner = gsub("[\r\n]", "",substr(table_stage$X3, 0, str_locate(table_stage$X3, "\n")[1]))
table_stage$winner
#lecture pour une année donnée :
url_year = paste(url_base, xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_main, 2), 2), 3), 1), 3), 1), 1), 1), 2), 1), e), 1))[["data-tabs-ajax"]], sep = "")
html_year = read_html(url_year)
url_stage = (html_year %>%
html_node(xpath = '//*[@data-tabs-target="stages"]') %>%
xml_attrs())[3]
url_stage = paste(url_base, url_stage, sep  ="")
html_stage = read_html(url_stage)
url_win = (html_year %>%
html_node(xpath = '//*[@data-tabs-target="winners"]') %>%
xml_attrs())[3]
url_win = paste(url_base, url_win, sep = "")
html_win = read_html(url_win)
table_stage = html_stage %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
colnames(table_stage) <- c("n","annee","depart","arrivee")
table_win = html_win %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
table_stage <- table_stage %>% mutate(id = row_number())
table_stage <- merge(x = table_stage, y = table_win, by.x = "id", by.y = "X1", all.x = TRUE)
table_stage$winner = gsub("[\r\n]", "",substr(table_stage$X3, 0, str_locate(table_stage$X3, "\n")[1]))
table_stage$winner
table_stage <- table_stage[,!names(table_stage) %in% c("X2", "X3")]
year = substr(table_stage$annee[1],nchar(table_stage$annee[1])-3, nchar(table_stage$annee[1]))
#INITIALISATION
url_main = "https://www.letour.fr/fr/histoire"
url_base = "https://www.letour.fr"
html_main = read_html(url_main)
e = 1
while(e <= 109){
#lecture pour une année donnée :
url_year = paste(url_base, xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_main, 2), 2), 3), 1), 3), 1), 1), 1), 2), 1), e), 1))[["data-tabs-ajax"]], sep = "")
html_year = read_html(url_year)
url_stage = (html_year %>%
html_node(xpath = '//*[@data-tabs-target="stages"]') %>%
xml_attrs())[3]
url_stage = paste(url_base, url_stage, sep  ="")
html_stage = read_html(url_stage)
url_win = (html_year %>%
html_node(xpath = '//*[@data-tabs-target="winners"]') %>%
xml_attrs())[3]
url_win = paste(url_base, url_win, sep = "")
html_win = read_html(url_win)
table_stage = html_stage %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
colnames(table_stage) <- c("n","annee","depart","arrivee")
table_win = html_win %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
table_stage <- table_stage %>% mutate(id = row_number())
table_stage <- merge(x = table_stage, y = table_win, by.x = "id", by.y = "X1", all.x = TRUE)
table_stage$winner = gsub("[\r\n]", "",substr(table_stage$X3, 0, str_locate(table_stage$X3, "\n")[1]))
table_stage <- table_stage[,!names(table_stage) %in% c("X2", "X3")]
year = substr(table_stage$annee[1],nchar(table_stage$annee[1])-3, nchar(table_stage$annee[1]))
output_name = paste("output/stages_",year,".csv", sep = "")
write.csv(table_stage, output_name)
print(paste("Finished year",year))
Sys.sleep(1)
e = e+1
}
View(table_stage)
url_win
View(html_win)
View(table_win)
table_stage$winner = substr(table_stage$X3, 0, str_locate(table_stage$X3, "\n")[1])
table_stage = html_stage %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
colnames(table_stage) <- c("n","annee","depart","arrivee")
table_win = html_win %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
table_stage <- table_stage %>% mutate(id = row_number())
table_stage <- merge(x = table_stage, y = table_win, by.x = "id", by.y = "X1", all.x = TRUE)
table_stage$winner = substr(table_stage$X3, 0, str_locate(table_stage$X3, "\n")[1])
table_win$X3
substr(table_stage$X3, 0, str_locate(table_stage$X3, "\n")[1])
str_locate(table_stage$X3, "\n")
str_locate(table_stage$X3, "\n")+3
str_locate(table_stage$X3, "\n")[1]+3
table_stage$winner = substr(table_stage$X3, 0, str_locate(table_stage$X3, "\n")[1]+3)
table_stage$winner = substr(table_stage$X3, 0, 20)
table_stage %>% mutate(winner = gsub("[\r\n]", "",substr(X3, 0, str_locate(X3, "\n")[1])))
table_stage$winner
table_stage = html_stage %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
colnames(table_stage) <- c("n","annee","depart","arrivee")
table_win = html_win %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
table_stage <- table_stage %>% mutate(id = row_number())
table_stage <- merge(x = table_stage, y = table_win, by.x = "id", by.y = "X1", all.x = TRUE)
table_stage %>%
mutate(winner = str_extract(X3, "[^_]+$"))
table_stage %>%
mutate(winner = str_extract(X3, "[^_]+$"))
table_stage %>%
dplyr::mutate(winner = str_extract(X3, "[^_]+$"))
View(table_stage)
table_stage %>%
dplyr::mutate(winner = str_extract(X3, "[^\n]+$"))
table_stage %>%
dplyr::mutate(winner = str_extract(X3, "[^\n]+"))
table_stage %>% mutate(winner = gsub("[\r\n]", "",substr(X3, 0, str_locate(X3, "\n")[1])))
View(table_stage)
table_stage$winner = gsub("[\r\n]", "",substr(table_stage$X3, 0, str_locate(table_stage$X3, "\n")[1]))
table_stage %>% mutate(winner = gsub("[\r\n]", "",substr(X3, 0, str_locate(X3, "\n")[1])))
table_stage = html_stage %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
colnames(table_stage) <- c("n","annee","depart","arrivee")
table_win = html_win %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
table_stage <- table_stage %>% mutate(id = row_number())
table_stage <- merge(x = table_stage, y = table_win, by.x = "id", by.y = "X1", all.x = TRUE)
table_stage %>%
dplyr::mutate(winner = str_extract(X3, "[^\n]+"))
table_stage %>%
dplyr::mutate(winner = str_extract(X3, "[^\n]+"))
table_stage %>%
mutate(table_stage, winner = str_extract(X3, "[^\n]+"))
mutate(table_stage, winner = str_extract(X3, "[^\n]+"))
View(table_stage)
table_stage = html_stage %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
colnames(table_stage) <- c("n","annee","depart","arrivee")
table_win = html_win %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
table_stage <- table_stage %>% mutate(id = row_number())
table_stage <- merge(x = table_stage, y = table_win, by.x = "id", by.y = "X1", all.x = TRUE)
table_stage$winner = str_extract(table_stage$X3, "[^\n]+")
#INITIALISATION
url_main = "https://www.letour.fr/fr/histoire"
url_base = "https://www.letour.fr"
html_main = read_html(url_main)
e = 1
while(e <= 109){
#lecture pour une année donnée :
url_year = paste(url_base, xml_attrs(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(xml_child(html_main, 2), 2), 3), 1), 3), 1), 1), 1), 2), 1), e), 1))[["data-tabs-ajax"]], sep = "")
html_year = read_html(url_year)
url_stage = (html_year %>%
html_node(xpath = '//*[@data-tabs-target="stages"]') %>%
xml_attrs())[3]
url_stage = paste(url_base, url_stage, sep  ="")
html_stage = read_html(url_stage)
url_win = (html_year %>%
html_node(xpath = '//*[@data-tabs-target="winners"]') %>%
xml_attrs())[3]
url_win = paste(url_base, url_win, sep = "")
html_win = read_html(url_win)
table_stage = html_stage %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
colnames(table_stage) <- c("n","annee","depart","arrivee")
table_win = html_win %>%
html_node(xpath = "/html/body/div/div/table/tbody") %>%
html_table()
table_stage <- table_stage %>% mutate(id = row_number())
table_stage <- merge(x = table_stage, y = table_win, by.x = "id", by.y = "X1", all.x = TRUE)
table_stage$winner = str_extract(table_stage$X3, "[^\n]+")
table_stage <- table_stage[,!names(table_stage) %in% c("X2", "X3")]
year = substr(table_stage$annee[1],nchar(table_stage$annee[1])-3, nchar(table_stage$annee[1]))
output_name = paste("output/stages_",year,".csv", sep = "")
write.csv(table_stage, output_name)
print(paste("Finished year",year))
Sys.sleep(1)
e = e+1
}
